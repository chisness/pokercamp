<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>#3 Rock Paper Scissors: Reading 1 – Poker Camp</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href=".././assets/favicon32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1R1JQVQ05N"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1R1JQVQ05N', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="#3 Rock Paper Scissors: Reading 1 – Poker Camp">
<meta property="og:description" content="">
<meta property="og:site_name" content="Poker Camp">
<meta name="twitter:title" content="#3 Rock Paper Scissors: Reading 1 – Poker Camp">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@pokercamporg">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src=".././assets/favicon32.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Poker Camp</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-camp-info" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Camp Info</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-camp-info">    
        <li>
    <a class="dropdown-item" href="../camp">
 <span class="dropdown-text">Poker and Applied Rationality Camp</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../aicamp">
 <span class="dropdown-text">AI Poker Camp</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://forms.gle/xx1tZNbwpYBLASmQ8" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mailbox2-flag"></i></a>
    <a href="https://discord.gg/KZQK2xN8Da" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-discord"></i></a>
    <a href="https://x.com/pokercamporg" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/chisness/pokercamp" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Challenges</li><li class="breadcrumb-item"><a href="../aipcs24/3rps_reading.html">#3: Rock Paper Scissors</a></li><li class="breadcrumb-item"><a href="../aipcs24/3rps_reading.html">Class Materials</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AIPC Summer 2024</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Challenges</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">#1: Kuhn Poker</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/1kuhn_reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optional Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/1kuhn_rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/1kuhn_challenge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Challenge</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge Review</span>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">#2: Leduc Poker</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/2leduc_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Class Materials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/2leduc_challenge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Challenge</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/2leduc_leaderboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaderboard</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge Review</span>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">#3: Rock Paper Scissors</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/3rps_reading.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Class Materials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/3rps_challenge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Challenge</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/3rps_leaderboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaderboard</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge Review</span>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">#4: Coming soon…</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
 <span class="menu-text">Class Materials</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge Review</span>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">#5: Coming soon…</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
 <span class="menu-text">Class Materials</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">Challenge Review</span>
  </li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Configuration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">General Setup</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/bots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building and Running Bots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/solvers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building and Running Solvers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">About the Course</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../aipcs24/sessions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sessions and Challenges</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">Instructors and TAs</span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#game-theory" id="toc-game-theory" class="nav-link active" data-scroll-target="#game-theory">Game Theory</a></li>
  <li><a href="#types-of-opponent-adaptation" id="toc-types-of-opponent-adaptation" class="nav-link" data-scroll-target="#types-of-opponent-adaptation">Types of Opponent Adaptation</a></li>
  <li><a href="#counterfactual-regret-minimization" id="toc-counterfactual-regret-minimization" class="nav-link" data-scroll-target="#counterfactual-regret-minimization">Counterfactual Regret Minimization</a>
  <ul class="collapse">
  <li><a href="#regret-and-strategies" id="toc-regret-and-strategies" class="nav-link" data-scroll-target="#regret-and-strategies">Regret and Strategies</a></li>
  <li><a href="#regret-matching" id="toc-regret-matching" class="nav-link" data-scroll-target="#regret-matching">Regret Matching</a></li>
  <li><a href="#rps-regret-matching-experiment" id="toc-rps-regret-matching-experiment" class="nav-link" data-scroll-target="#rps-regret-matching-experiment">RPS Regret Matching Experiment</a></li>
  <li><a href="#iterating-through-the-tree" id="toc-iterating-through-the-tree" class="nav-link" data-scroll-target="#iterating-through-the-tree">Iterating through the Tree</a></li>
  <li><a href="#alternativesupdates-to-original-algorithm" id="toc-alternativesupdates-to-original-algorithm" class="nav-link" data-scroll-target="#alternativesupdates-to-original-algorithm">Alternatives/Updates to Original Algorithm</a></li>
  </ul></li>
  <li><a href="#data-talk-paper-scissors" id="toc-data-talk-paper-scissors" class="nav-link" data-scroll-target="#data-talk-paper-scissors">Data: Talk Paper Scissors</a></li>
  <li><a href="#more-exercises" id="toc-more-exercises" class="nav-link" data-scroll-target="#more-exercises">More Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Challenges</li><li class="breadcrumb-item"><a href="../aipcs24/3rps_reading.html">#3: Rock Paper Scissors</a></li><li class="breadcrumb-item"><a href="../aipcs24/3rps_reading.html">Class Materials</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">#3 Rock Paper Scissors: Reading 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<iframe width="560" height="315" src="https://www.youtube.com/embed/b0SoKWLkmLU?si=0AQ3_NgHOe4tc4OU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>
<p>Rock defeats scissors, scissors defeats paper, and paper defeats rock. You get 1 point for winning, -1 point for losing, and 0 points for ties.</p>
<p>The goal of this challenge is to focus on tracking opponent distributions and how to respond to them.</p>
<section id="game-theory" class="level3">
<h3 class="anchored" data-anchor-id="game-theory">Game Theory</h3>
<p>RPS is a zero-sum game and the payouts are symmetrical as follows:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Player 1/2</th>
<th>Rock</th>
<th>Paper</th>
<th>Scissors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rock</td>
<td>(0, 0)</td>
<td>(-1, 1)</td>
<td>(1, -1)</td>
</tr>
<tr class="even">
<td>Paper</td>
<td>(1, -1)</td>
<td>(0, 0)</td>
<td>(-1, 1)</td>
</tr>
<tr class="odd">
<td>Scissors</td>
<td>(-1, 1)</td>
<td>(1, -1)</td>
<td>(0, 0)</td>
</tr>
</tbody>
</table>
<p>The Nash Equilibrium strategy is to play each action <span class="math inline">\(r = p = s = 1/3\)</span> of the time.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nash Equilibrium Strategy for RPS
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If Player 1 plays Rock with probability <span class="math inline">\(r\)</span>, Paper with probability <span class="math inline">\(p\)</span>, and Scissors with probability <span class="math inline">\(s\)</span>, we have the following expected value equations for Player 2:</p>
<p><span class="math inline">\(\mathbb{E}(\text{R}) = -1*p + 1*s\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{P}) = 1*r - 1*s\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{S}) = -1*r + 1*p\)</span></p>
<p>Since no action dominates, we know that the EV of every strategic action should be equal.</p>
<p><span class="math inline">\(\mathbb{E}(\text{R}) = \mathbb{E}(\text{P})\)</span></p>
<p><span class="math inline">\(-1*p + 1*s = 1*r - 1*s\)</span></p>
<p><span class="math inline">\(2*s = p + r\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{R}) = \mathbb{E}(\text{S})\)</span></p>
<p><span class="math inline">\(-1*p + 1*s = -1*r + 1*p\)</span></p>
<p><span class="math inline">\(s + r = 2*p\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{P}) = \mathbb{E}(\text{S})\)</span></p>
<p><span class="math inline">\(1*r - 1*s = -1*r + 1*p\)</span></p>
<p><span class="math inline">\(2*r = s + p\)</span></p>
<p>Solving the equations:</p>
<p><span class="math inline">\(r = 2*s - p\)</span></p>
<p><span class="math inline">\(s + (2*s - p) = 2*p\)</span></p>
<p><span class="math inline">\(3*s = 3*p\)</span></p>
<p><span class="math inline">\(s = p\)</span></p>
<p><span class="math inline">\(s + r = 2*p\)</span></p>
<p><span class="math inline">\(s + r = 2*s\)</span></p>
<p><span class="math inline">\(r = s\)</span></p>
<p>We know that all are equal:</p>
<p><span class="math inline">\(s = p = r\)</span></p>
<p>We also know that they must all sum to <span class="math inline">\(1\)</span>:</p>
<p><span class="math inline">\(r + p + s = 1\)</span></p>
<p>Since they’re all equal and sum to <span class="math inline">\(1\)</span>, we can substitute <span class="math inline">\(p\)</span> and <span class="math inline">\(s\)</span> with <span class="math inline">\(r\)</span>:</p>
<p><span class="math inline">\(3*r = 1\)</span></p>
<p><span class="math inline">\(r = 1/3\)</span></p>
<p>So all actions are taken with probability <span class="math inline">\(1/3\)</span>:</p>
<p><span class="math inline">\(r = p = s = 1/3\)</span></p>
</div>
</div>
</div>
<p>Playing this strategy means that whatever your opponent does, you will breakeven! You can see this interactively below:</p>
<iframe src="rps_strategy.html" width="100%" height="600" style="border:none;">
</iframe>
</section>
<section id="types-of-opponent-adaptation" class="level3">
<h3 class="anchored" data-anchor-id="types-of-opponent-adaptation">Types of Opponent Adaptation</h3>
<ol type="1">
<li>Offline: In Kuhn Poker, we discussed building an agent based on weights that play optimally against a specific fixed opponent or group of opponents.</li>
</ol>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Best Strategy in RPS Against Fixed Opponent
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you maximize in RPS knowing the opponent plays a fixed non-Nash strategy that you know? You can try this by playing with the above interactive with the 40% Rock option.</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If we knew that our opponent played Rock 100% of the time, we should play Paper 100% of the time.</p>
<p>In general, if our opponent plays a mixed strategy, there is always a best pure strategy that is the move that beats their most-played action.</p>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Online: Now in this challenge we want to think about <em>online</em> opponent adaptation. Suppose now that we don’t know how our opponent is going to play, but want to build an agent that adapts to them in real time as the match is going on.</li>
</ol>
</section>
<section id="counterfactual-regret-minimization" class="level2">
<h2 class="anchored" data-anchor-id="counterfactual-regret-minimization">Counterfactual Regret Minimization</h2>
<p>As we think about solving larger games, we start to look at iterative algorithms.</p>
<p>The most popular method for iteratively solving poker games is the Counterfactual Regret Minimization (CFR) algorithm. CFR is an iterative algorithm developed in 2007 at the University of Alberta that converges to Nash equilibrium in two player zero-sum games.</p>
<p>(Note: The handout solver does not exactly use CFR. You can make updates to the solver however you would like, including modifying it to become CFR.)</p>
<p>What is a counterfactual? Here’s an example:</p>
<p><strong>Actual event:</strong> I didn’t bring an umbrella, and I got wet in the rain</p>
<p><strong>Counterfactual event:</strong> If I had brought an umbrella, I wouldn’t have gotten wet</p>
<section id="regret-and-strategies" class="level3">
<h3 class="anchored" data-anchor-id="regret-and-strategies">Regret and Strategies</h3>
<p>A strategy at an infoset is a probability distribution over each possible action.</p>
<p>Regret is a measure of how much each strategy at an infoset is preferred and is used as a way to update strategies.</p>
<p>For a given P1 strategy and P2 strategy, a player has regret when they take an action at an infoset that was not the highest-EV action at that infoset.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Regret Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><img src="assets/basictree.png" class="img-fluid"></p>
<p>What is the regret for each action?</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Action</th>
<th>Regret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td></td>
</tr>
<tr class="even">
<td>B</td>
<td></td>
</tr>
<tr class="odd">
<td>C</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Action</th>
<th>Regret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>4</td>
</tr>
<tr class="even">
<td>B</td>
<td>2</td>
</tr>
<tr class="odd">
<td>C</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expected Value Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><img src="assets/basictree.png" class="img-fluid"></p>
<p>If taking a uniform strategy at this node (i.e.&nbsp;<span class="math inline">\(\frac{1}{3}\)</span> for each action), then what is the expected value of the node?</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math inline">\(\mathbb{E} = \frac{1}{3}*1 + \frac{1}{3}*3+\frac{1}{3}*5 = 0.33+1+1.67 = 3\)</span></p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Poker Regret Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><img src="assets/basictree.png" class="img-fluid"></p>
<p>In poker games, the regret for each action is defined as the value for that action minus the expected value of the node. Give the regret values for each action under this definition.</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Action</th>
<th>Value</th>
<th>Poker Regret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>1</td>
<td>-2</td>
</tr>
<tr class="even">
<td>B</td>
<td>3</td>
<td>0</td>
</tr>
<tr class="odd">
<td>C</td>
<td>5</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>At a node in a poker game, the player prefers actions with higher regrets by this definition.</p>
</div>
</div>
</div>
<p>Each infoset maintains a <code>strategy</code> and <code>regret</code> tabular counter for each action. These accumulate the sum of all strategies and the sum of all regrets.</p>
<p>In a game like Rock Paper Scissors, there is effectively only one infoset, so only one table for <code>strategy</code> over each action (Rock, Paper, Scissors) and one table for <code>regret</code> over each action (Rock, Paper, Scissors).</p>
<p>Regrets are linked to strategies through a policy called <em>regret matching</em>.</p>
</section>
<section id="regret-matching" class="level3">
<h3 class="anchored" data-anchor-id="regret-matching">Regret Matching</h3>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
RPS Regret Details
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In general, we define regret as:</p>
<p><span class="math inline">\(\text{Regret} = u(\text{Alternative Strategy}) − u(\text{Current Strategy})\)</span></p>
<p>We prefer alternative actions with high regret and wish to minimize our overall regret.</p>
<p>We play Rock and opponent plays Paper <span class="math inline">\(\implies \text{u(rock,paper)} = -1\)</span></p>
<p><span class="math inline">\(\text{Regret(scissors)} = \text{u(scissors,paper)} - \text{u(rock,paper)} = 1-(-1) = 2\)</span></p>
<p><span class="math inline">\(\text{Regret(paper)} = \text{u(paper,paper)} - \text{u(rock,paper)} = 0-(-1) = 1\)</span></p>
<p><span class="math inline">\(\text{Regret(rock)} = \text{u(rock,paper)} - \text{u(rock,paper)} = -1-(-1) = 0\)</span></p>
<p>We play Scissors and opponent plays Paper <span class="math inline">\(\implies \text{u(scissors,paper)} = 1\)</span></p>
<p><span class="math inline">\(\text{Regret(scissors)} = \text{u(scissors,paper)} - \text{u(scissors,paper)} = 1-1 = 0\)</span></p>
<p><span class="math inline">\(\text{Regret(paper)} = \text{u(paper,paper)} - \text{u(scissors,paper)} = 0-1 = -1\)</span></p>
<p><span class="math inline">\(\text{Regret(rock)} = \text{u(rock,paper)} - \text{u(scissors,paper)} = -1-1 = -2\)</span></p>
<p>We play Paper and opponent plays Paper <span class="math inline">\(\implies \text{u(paper,paper)} = 0\)</span></p>
<p><span class="math inline">\(\text{Regret(scissors)} = \text{u(scissors,paper)} - \text{u(paper,paper)} = 1-0 = 1\)</span></p>
<p><span class="math inline">\(\text{Regret(paper)} = \text{u(paper,paper)} - \text{u(paper,paper)} = 0-0 = 0\)</span>$</p>
<p><span class="math inline">\(\text{Regret(rock)} = \text{u(rock,paper)} - \text{u(paper,paper)} = -1-0 = -1\)</span></p>
<p>To generalize:</p>
<ul>
<li>The action played always gets a regret of 0 since the “alternative” is really just that same action</li>
<li>When we play a tying action, the alternative losing action gets a regret of -1 and the alternative winning action gets a regret of +1</li>
<li>When we play a winning action, the alternative tying action gets a regret of -1 and the alternative losing action gets a regret of -2</li>
<li>When we play a losing action, the alternative winning action gets a regret of +2 and the alternative tying action gets a regret of +1</li>
</ul>
<p>After each play, we accumulate regrets for each of the 3 actions.</p>
</div>
</div>
</div>
<p>We decide our strategy probability distribution using regret matching, which means playing a strategy that normalizes over the <em>positive</em> accumulated regrets, i.e.&nbsp;playing in proportion to the positive regrets.</p>
<p>Example from <a href="https://www.ma.imperial.ac.uk/~dturaev/neller-lanctot.pdf">Marc Lanctot’s CFR Tutorial</a>:</p>
<ul>
<li><p>Game 1: Choose Rock and opponent chooses Paper</p>
<ul>
<li>Lose 1</li>
<li>Rock: Regret 0</li>
<li>Paper: Regret 1</li>
<li>Scissors: Regret 2</li>
</ul></li>
<li><p>Next Action: Proportional <span class="math display">\[
\begin{pmatrix}
\text{Rock} &amp; 0/3 = 0 \\
\text{Paper} &amp; 1/3 = 0.333 \\
\text{Scissors} &amp; 2/3 = 0.667
\end{pmatrix}
\]</span></p></li>
<li><p>Game 2: Choose Scissors (With probability <span class="math inline">\(2/3\)</span>) and opponent chooses Rock</p>
<ul>
<li>Lose 1</li>
<li>Rock: Regret 1</li>
<li>Paper: Regret 2</li>
<li>Scissors: Regret 0</li>
</ul></li>
<li><p>Cumulative regrets:</p>
<ul>
<li>Rock: 1</li>
<li>Paper: 3</li>
<li>Scissors: 2</li>
</ul></li>
<li><p>Next Action: Proportional <span class="math display">\[
\begin{pmatrix}
\text{Rock} &amp; 1/6 = 0167 \\
\text{Paper} &amp; 3/6 = 0.500 \\
\text{Scissors} &amp; 2/6 = 0.333
\end{pmatrix}
\]</span></p></li>
</ul>
<p>Regret matching definitions:</p>
<ul>
<li><span class="math inline">\(a\)</span> is actions</li>
<li><span class="math inline">\(\sigma\)</span> is strategy</li>
<li><span class="math inline">\(t\)</span> is time</li>
<li><span class="math inline">\(i\)</span> is player</li>
<li><span class="math inline">\(R\)</span> is cumulative regret</li>
</ul>
<p><span class="math display">\[
\sigma_i^t(a) = \begin{cases}
\frac{\max(R_i^t(a), 0)}{\sum_{a' \in A} \max(R_i^t(a'), 0)} &amp; \text{if } \sum_{a' \in A} \max(R_i^t(a'), 0) &gt; 0 \\
\frac{1}{|A|} &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p>This is showing that we take the cumulative regret for an action divided by the cumulative regrets for all actions (normalizing) and then play that strategy for this action on the next iteration.</p>
<p>If all cumulative regrets are <span class="math inline">\(\leq 0\)</span> then we use the uniform distribution.</p>
<p>If cumulative regrets are positive, but are are <span class="math inline">\(&lt;0\)</span> for a specific action, then we use <span class="math inline">\(0\)</span> for that action.</p>
<p>In code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_strategy(<span class="va">self</span>):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#First find the normalizing sum</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        normalizing_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> a <span class="kw">in</span> <span class="bu">range</span>(NUM_ACTIONS):</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.regret_sum[a] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.strategy[a] <span class="op">=</span> <span class="va">self</span>.regret_sum[a]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.strategy[a] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            normalizing_sum <span class="op">+=</span> <span class="va">self</span>.strategy[a]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Then normalize each action</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> a <span class="kw">in</span> <span class="bu">range</span>(NUM_ACTIONS):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> normalizing_sum <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.strategy[a] <span class="op">/=</span> normalizing_sum</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.strategy[a] <span class="op">=</span> <span class="fl">1.0</span><span class="op">/</span>NUM_ACTIONS</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.strategy_sum[a] <span class="op">+=</span> <span class="va">self</span>.strategy[a]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.strategy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After using regret matching and after many iterations, we can minimize expected regret by using the <em>average</em> strategy at the end, which is the strategy that converges to equilibrium.</p>
<p>If two players were training against each other using regret matching, they would converge to the Nash Equilibrium of <span class="math inline">\(1/3\)</span> for each action using the average strategy in Rock Paper Scissors.</p>
</section>
<section id="rps-regret-matching-experiment" class="level3">
<h3 class="anchored" data-anchor-id="rps-regret-matching-experiment">RPS Regret Matching Experiment</h3>
<p>Here we show that regret matching converges only using the average strategy over 10,000 iterations:</p>
<p><img src="assets/rps_avg.png" class="img-fluid"></p>
<p>The bottom shows both players converging to <span class="math inline">\(1/3\)</span>, while the top shows Player 1’s volatile current strategies that are cycling around.</p>
<p>Suppose that your opponent Player 2 is playing 40% Rock, 30% Paper, and 30% Scissors. Here is a regret matching 10,000 game experiment. It shows that it takes around 1,600 games before Player 1 plays only Paper (this will vary).</p>
<p><img src="assets/rps_rm.png" class="img-fluid"></p>
<p>We see that if there is a fixed player, regret matching converges to the best strategy.</p>
<p>But what if your opponent is not using a fixed strategy? We’ll talk about that soon.</p>
</section>
<section id="iterating-through-the-tree" class="level3">
<h3 class="anchored" data-anchor-id="iterating-through-the-tree">Iterating through the Tree</h3>
<p>The core feature of the iterative algorithms is self-play by traversing the game tree over all <strong>infosets</strong> and tracking the strategies and regrets at each.</p>
<p>From above, we know how to find the strategy and regret in the simple Rock Paper Scissors environment.</p>
<p>In poker:</p>
<ul>
<li><p>Strategies are determined the same as above, through regret matching from the previous <code>regret</code> values at the specific information set for each action</p></li>
<li><p>CFR definitions:</p>
<ul>
<li><span class="math inline">\(a\)</span> is actions</li>
<li><span class="math inline">\(I\)</span> is infoset</li>
<li><span class="math inline">\(\sigma\)</span> is strategy</li>
<li><span class="math inline">\(t\)</span> is time</li>
<li><span class="math inline">\(i\)</span> is player</li>
<li><span class="math inline">\(R\)</span> is cumulative regret</li>
<li><span class="math inline">\(z\)</span> is a terminal node</li>
<li><span class="math inline">\(u\)</span> is utility (payoffs)</li>
<li><span class="math inline">\(p\)</span> is the current player who plays at this node</li>
<li><span class="math inline">\(-p\)</span> is the the opponent player and chance</li>
<li><span class="math inline">\(v\)</span> is counterfactual value</li>
</ul></li>
<li><p>Counterfactual values are effectively the value of an information set. They are weighted by the probability of opponent and chance playing to this node (in other words, the probability of playing to this node if this player tried to do so).</p>
<ul>
<li><p>Counterfactual value: <span class="math inline">\(v^\sigma (I) = \sum_{z\in Z_I} \pi^{\sigma}_{-p}(z[I])\pi^{\sigma}(z[I] \rightarrow z)u_p(z)\)</span></p></li>
<li><p><span class="math inline">\(\sum_{z\in Z_I}\)</span> is summing over all terminal histories reachable from this node</p></li>
<li><p><span class="math inline">\(\pi^{\sigma}_{-p}(z[I])\)</span> is the probability of opponents and chance reaching this node</p></li>
<li><p><span class="math inline">\(\pi^{\sigma}(z[I] \rightarrow z)\)</span> is the probability of playing from this node to terminal history <span class="math inline">\(z\)</span>, i.e.&nbsp;the weight component of the expected value</p></li>
<li><p><span class="math inline">\(u_p(z)\)</span> is the utility at terminal history <span class="math inline">\(z\)</span>, i.e.&nbsp;the value component of the expected value</p></li>
</ul></li>
<li><p>Instantaneous regrets are based on action values compared to infoset EV. Each action EV then adds to its <code>regret</code> counter:</p>
<ul>
<li><span class="math inline">\(r^t(I,a) = v^{\sigma^t}(I,a) - v^{\sigma^t}(I)\)</span></li>
</ul></li>
<li><p>Cumulative (counterfactual) regrets are the sum of the individual regrets:</p>
<ul>
<li><span class="math inline">\(R^T(I,a) = \sum_{t=1}^T r^t(I,a)\)</span></li>
</ul></li>
</ul>
</section>
<section id="alternativesupdates-to-original-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="alternativesupdates-to-original-algorithm">Alternatives/Updates to Original Algorithm</h3>
<ul>
<li><p>CFR+ variation such that regrets can’t be <span class="math inline">\(\leq 0\)</span></p></li>
<li><p>Linear CFR such that regrets are weighted by their recency</p></li>
<li><p>Sampling</p>
<ul>
<li>External: Sample chance and opponent nodes</li>
<li>Chance: Sample chance only</li>
<li>Outcome: Sample outcomes</li>
</ul></li>
</ul>
</section>
</section>
<section id="data-talk-paper-scissors" class="level2">
<h2 class="anchored" data-anchor-id="data-talk-paper-scissors">Data: Talk Paper Scissors</h2>
<p><a href="https://eieio.games/nonsense/game-13-talk-paper-scissors/">eieio games</a> made a Rock Paper Scissors over voice game in which players call a phone number and get matched up with another player for a 3 game RPS match.</p>
<p>They published their 40,000 round data on X:</p>
<p><img src="assets/tps.png" class="img-fluid"> <strong>Overall: R 37.2%, P 35.4%, S 27.4%</strong></p>
<p><img src="assets/tpsr1.png" class="img-fluid"> <strong>Round 1: R 39.7%, P 37.6%, S 22.7%</strong></p>
<p><img src="assets/tpsr2.png" class="img-fluid"> <strong>Round 2: R 34.0%, 33.4%, 32.6%</strong></p>
<p><img src="assets/tpsr3.png" class="img-fluid"> <strong>Round 3: R 37.2%, 34.7%, 28.1%</strong></p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expected Value Against TPS Player
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the best strategy per round against the average TPS player? What is your expected value per round and overall?</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The best strategy is to always play Paper.</p>
<p><span class="math inline">\(\mathbb{E}(\text{Round 1}) = 0.397*1 + 0.376*0 + 0.227*-1 = 0.17\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{Round 2}) = 0.34*1 + 0.334*0 + 0.326*-1 = 0.014\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{Round 3}) = 0.372*1 + 0.347*0 + 0.281*-1 = 0.091\)</span></p>
<p><span class="math inline">\(\mathbb{E}(\text{Round 4}) = 0.17 + 0.014 + 0.091 = 0.275\)</span></p>
</div>
</div>
</div>
</section>
<section id="more-exercises" class="level2">
<h2 class="anchored" data-anchor-id="more-exercises">More Exercises</h2>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Maximize Against non-Nash Fixed Opponent
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you maximize in RPS knowing the opponent plays a fixed non-Nash strategy that you don’t know?</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One option is to play the equilibrium strategy until you get a significant sample on your opponent and then to exploit their strategy going forward.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Strategy Against No-Rock Opponent
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the optimal play if your opponent can’t play Rock?</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Player 1/2</th>
<th>Paper</th>
<th>Scissors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rock</td>
<td>(-1, 1)</td>
<td>(1, -1)</td>
</tr>
<tr class="even">
<td>Paper</td>
<td>(0, 0)</td>
<td>(-1, 1)</td>
</tr>
<tr class="odd">
<td>Scissors</td>
<td>(1, -1)</td>
<td>(0, 0)</td>
</tr>
</tbody>
</table>
<p>We can see that Player 1 playing Paper is dominated by Scissors, so Player 1 should never play Paper.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Player 1/2</th>
<th>Paper</th>
<th>Scissors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rock</td>
<td>(-1, 1)</td>
<td>(1, -1)</td>
</tr>
<tr class="even">
<td>Scissors</td>
<td>(1, -1)</td>
<td>(0, 0)</td>
</tr>
</tbody>
</table>
<p>In the reduced game, we see that if Player 2 plays Paper with probability <span class="math inline">\(p\)</span> and Scissors with probability <span class="math inline">\(s\)</span>, then:</p>
<p><span class="math inline">\(\mathbb{E}(\text{P1 R}) = -1*p + 1*s = -p + s\)</span> <span class="math inline">\(\mathbb{E}(\text{P1 S}) = 1*p + 0*s = p\)</span></p>
<p>Setting these equal, <span class="math inline">\(-p + s = p \Rightarrow s = 2p\)</span>.</p>
<p>We also know that <span class="math inline">\(s + p = 1\)</span>.</p>
<p>Therefore <span class="math inline">\(s = 1 - p\)</span> and <span class="math inline">\(1 - p = 2p \Rightarrow 1 = 3p \Rightarrow p = 1/3\)</span>.</p>
<p>Therefore, <span class="math inline">\(s = 1 - 1/3 = 2/3\)</span>.</p>
<p>For Player 2, we have <span class="math inline">\(s = 2/3\)</span> and <span class="math inline">\(p = 1/3\)</span>.</p>
<p>For Player 1, we can solve similarly:</p>
<p><span class="math inline">\(\mathbb{E}(\text{P2 P}) = 1*r - 1*s = r - s\)</span> <span class="math inline">\(\mathbb{E}(\text{P2 S}) = -1*r + 0*s = -r\)</span></p>
<p><span class="math inline">\(r - s = -r \Rightarrow 2r = s\)</span></p>
<p>We also know that <span class="math inline">\(r + s = 1\)</span>.</p>
<p>Therefore <span class="math inline">\(s = 1 - r\)</span> and <span class="math inline">\(1 - r = 2r \Rightarrow 1 = 3r \Rightarrow r = 1/3\)</span>.</p>
<p>Therefore, <span class="math inline">\(s = 1 - 1/3 = 2/3\)</span>.</p>
<p>For Player 2, we have <span class="math inline">\(s = 2/3\)</span> and <span class="math inline">\(p = 1/3\)</span>.</p>
<p>Inserting these probabilities, we have:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Player 1/2</th>
<th>Paper (1/3)</th>
<th>Scissors (2/3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rock (1/3)</td>
<td>(-1, 1) (1/9)</td>
<td>(1, -1) (2/9)</td>
</tr>
<tr class="even">
<td>Scissors (2/3)</td>
<td>(1, -1) (2/9)</td>
<td>(0, 0) (4/9)</td>
</tr>
</tbody>
</table>
<p>Therefore Player 1 has payoffs of: <span class="math inline">\(1/9 * -1 + 2/9 * 1 + 2/9 * 1 + 4/9 * 0 = 3/9 = 1/3\)</span>. Therefore the player that can still play Rock has an advantage of <span class="math inline">\(1/3\)</span> at equilibrium.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Maximize Against Adapting Rock Opponent
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Suppose that your opponent is forced to play Rock exactly</li>
</ol>
<p>Suppose that your opponent gets a card with probability <span class="math inline">\(X\)</span> such that <span class="math inline">\(X\%\)</span> of the time they are forced to play Rock What if the opponent is adapting to you, but 10% of the time they are forced to play Rock?</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Soon</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Skewed Rock Payoff
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the equilibrium strategy if the payoff for Rock over Scissors is 2 (others stay the same)?</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Soon</p>
</div>
</div>
</div>



</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2024 pokercamp.org. All rights reserved.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>